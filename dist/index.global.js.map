{"version":3,"sources":["../src/utils/position.ts","../src/VirtualScroll.ts"],"sourcesContent":["export const getCurrentMobilePositionFromEvent = (e: any) => {\n  let position = e;\n  // touch event\n  if (e.targetTouches && e.targetTouches.length >= 1) {\n    position = e.targetTouches[0];\n  }\n\n  // mouse event\n  return { y: position.clientY, x: position.clientX };\n};\n","import { getCurrentMobilePositionFromEvent } from \"./utils/position\";\n\ninterface VirtualScrollBoundaries {\n  minX?: number;\n  minY?: number;\n  maxX?: number;\n  maxY?: number;\n}\n\ninterface VirtualScrollEventPayload {\n  currentX: number;\n  currentY: number;\n  offsetX: number;\n  offsetY: number;\n}\n\ninterface VirtualScrollConfig {\n  horizontal: boolean;\n  vertical: boolean;\n  keyBoardOffset: number;\n  boundaries?: VirtualScrollBoundaries;\n}\n\nclass VirtualScroll {\n  static Events = {\n    scroll: \"virtual-scroll-event-scroll\",\n  };\n  element: Window | HTMLElement = window;\n  config: VirtualScrollConfig;\n  pageX: number = 0;\n  pageY: number = 0;\n\n  keyBindings: { [key: string]: [number, number] } = {\n    down: [1, 0],\n    up: [-1, 0],\n    right: [0, 1],\n    left: [0, -1],\n  };\n  get boundaries(): VirtualScrollBoundaries {\n    return this.config.boundaries || {};\n  }\n  private mobileConfig: any = {\n    pressed: false,\n    timeConstant: 325,\n\n    reference: {\n      x: 0,\n      y: 0,\n    },\n    velocity: {\n      x: 0,\n      y: 0,\n    },\n    frame: {\n      x: 0,\n      y: 0,\n    },\n    target: {\n      x: 0,\n      y: 0,\n    },\n    timestamp: 0,\n    ticker: undefined,\n    amplitude: { x: 0, y: 0 },\n  };\n\n  constructor(\n    config: VirtualScrollConfig = {\n      vertical: true,\n      horizontal: false,\n      keyBoardOffset: 50,\n      boundaries: {},\n    }\n  ) {\n    this.config = config;\n\n    this.setEventListeners();\n  }\n\n  private scroll(offsetX: number, offsetY: number) {\n    if (this.config.vertical) {\n      this.pageY = this.pageY + offsetY;\n    }\n    if (this.config.horizontal) {\n      this.pageX = this.pageX + offsetX;\n    }\n    if (\n      this.boundaries.minX !== undefined &&\n      this.pageX < this.boundaries.minX\n    ) {\n      this.pageX = this.boundaries.minX;\n    }\n    if (\n      this.boundaries.maxX !== undefined &&\n      this.pageX > this.boundaries.maxX\n    ) {\n      this.pageX = this.boundaries.maxX;\n    }\n\n    if (\n      this.boundaries.minY !== undefined &&\n      this.pageY < this.boundaries.minY\n    ) {\n      this.pageY = this.boundaries.minY;\n    }\n\n    if (\n      this.boundaries.maxY !== undefined &&\n      this.pageY > this.boundaries.maxY\n    ) {\n      this.pageY = this.boundaries.maxY;\n    }\n\n    this.triggerEvent(VirtualScroll.Events.scroll, {\n      currentX: this.pageX,\n      currentY: this.pageY,\n      offsetX,\n      offsetY,\n    });\n  }\n\n  handleMouseScroll = (e: WheelEvent) => {\n    e.preventDefault();\n    this.scroll(e.deltaX, e.deltaY);\n  };\n\n  handleKeyDownMove = (e: KeyboardEvent) => {\n    console.log(e.key);\n    const keyBindChange = this.keyBindings[e.key];\n    if (keyBindChange) {\n      this.scroll(\n        keyBindChange[0] * this.config.keyBoardOffset,\n        keyBindChange[1] * this.config.keyBoardOffset\n      );\n    }\n  };\n\n  trackMobile() {\n    const now = Date.now();\n    const elapsed = now - this.mobileConfig.timestamp;\n    this.mobileConfig.timestamp = now;\n    const deltaX = this.pageX - this.mobileConfig.frame.x;\n    const deltaY = this.pageY - this.mobileConfig.frame.y;\n\n    this.mobileConfig.frame.x = this.pageX;\n    this.mobileConfig.frame.y = this.pageY;\n\n    const vX = (1000 * deltaX) / (1 + elapsed);\n    const vY = (1000 * deltaY) / (1 + elapsed);\n\n    this.mobileConfig.velocity.x =\n      0.8 * vX + 0.2 * this.mobileConfig.velocity.x;\n    this.mobileConfig.velocity.y =\n      0.8 * vY + 0.2 * this.mobileConfig.velocity.y;\n  }\n\n  mobileTouchStart(e: any) {\n    this.mobileConfig.pressed = true;\n    this.mobileConfig.reference = getCurrentMobilePositionFromEvent(e);\n\n    this.mobileConfig.velocity = this.mobileConfig.amplitude = { x: 0, y: 0 };\n    this.mobileConfig.frame.x = this.pageX;\n    this.mobileConfig.frame.y = this.pageY;\n    this.mobileConfig.timestamp = Date.now();\n    clearInterval(this.mobileConfig.ticker);\n    this.mobileConfig.ticker = setInterval(this.trackMobile, 100);\n    if (e.target.nodeName !== \"A\") {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n  }\n\n  mobileTouchMove(e: any) {\n    const { pressed, reference } = this.mobileConfig;\n    if (pressed) {\n      const { x, y } = getCurrentMobilePositionFromEvent(e);\n      let offsetY = reference.y - y;\n      let offsetX = reference.x - x;\n\n      if (offsetY > 2 || offsetY < -2) {\n        offsetY = 0;\n      }\n\n      if (offsetX > 2 || offsetX < -2) {\n        offsetX = 0;\n      }\n      reference.y = y;\n      this.scroll(offsetX, offsetY);\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  }\n  mobileAutoScroll = () => {\n    let deltaX = 0;\n    let deltaY = 0;\n\n    const { amplitude, timestamp, timeConstant, target } = this.mobileConfig;\n\n    if (amplitude.x) {\n      const elapsed = Date.now() - timestamp;\n      deltaX = -amplitude.x * Math.exp(-elapsed / timeConstant);\n    }\n    if (amplitude.y) {\n      const elapsed = Date.now() - timestamp;\n      deltaY = -amplitude.y * Math.exp(-elapsed / timeConstant);\n    }\n    if (deltaX > 0.5 || deltaX < -0.5 || deltaY > 0.5 || deltaY < -0.5) {\n      this.scroll(target.x + deltaX, target.y + deltaY);\n      requestAnimationFrame(this.mobileAutoScroll);\n    } else {\n      this.scroll(target.x, target.y);\n    }\n  };\n  mobileTouchEnd(e: any) {\n    const { ticker, amplitude, target, velocity } = this.mobileConfig;\n    this.mobileConfig.pressed = false;\n\n    clearInterval(ticker);\n    if (velocity.x > 10 || velocity.x < -10) {\n      amplitude.x = 0.8 * velocity.x;\n      target.x = Math.round(this.pageX + amplitude.x);\n    }\n    if (velocity.y > 10 || velocity.y < -10) {\n      amplitude.y = 0.8 * velocity.y;\n      target.y = Math.round(this.pageX + amplitude.y);\n    }\n    if (amplitude.x || amplitude.y) {\n      this.mobileConfig.timestamp = Date.now();\n      requestAnimationFrame(this.mobileAutoScroll);\n    }\n    if (e.target && e.target.nodeName !== \"A\") {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n  }\n\n  scrollEventKey =\n    \"onwheel\" in document.createElement(\"div\") ? \"wheel\" : \"mousewheel\";\n  setEventListeners() {\n    // @ts-ignore-next-line\n    this.element.addEventListener(this.scrollEventKey, this.handleMouseScroll, {\n      passive: false,\n    });\n    window.document.addEventListener(\"keydown\", this.handleKeyDownMove);\n\n    this.element.addEventListener(\"touchstart\", this.mobileTouchStart, {\n      passive: false,\n    });\n    this.element.addEventListener(\"touchmove\", this.mobileTouchMove, {\n      passive: false,\n    });\n    this.element.addEventListener(\"touchend\", this.mobileTouchEnd, {\n      passive: false,\n    });\n  }\n\n  /**\n   * EVENTS\n   */\n  eventWrappers: any[] = [];\n  triggerEvent(eventName: string, object: VirtualScrollEventPayload) {\n    document.dispatchEvent(new CustomEvent(eventName, { detail: object }));\n  }\n  on(\n    key: keyof typeof VirtualScroll.Events,\n    cb: (payload: VirtualScrollEventPayload) => void\n  ) {\n    const wrapped: any = ({ detail }: { detail: VirtualScrollEventPayload }) =>\n      cb(detail);\n    // @ts-ignore\n    this.eventWrappers[cb] = wrapped;\n    document.addEventListener(VirtualScroll.Events[key], wrapped);\n  }\n}\nexport default VirtualScroll;\n"],"mappings":"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","names":[]}