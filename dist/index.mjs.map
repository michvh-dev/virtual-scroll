{"version":3,"sources":["../src/utils/position.ts","../src/VirtualScroll.ts"],"sourcesContent":["export const getCurrentMobilePositionFromEvent = (e: any) => {\n  let position = e;\n  // touch event\n  if (e.targetTouches && e.targetTouches.length >= 1) {\n    position = e.targetTouches[0];\n  }\n\n  // mouse event\n  return { y: position.clientY, x: position.clientX };\n};\n","import { getCurrentMobilePositionFromEvent } from \"./utils/position\";\n\ninterface VirtualScrollBoundaries {\n  minX?: number;\n  minY?: number;\n  maxX?: number;\n  maxY?: number;\n}\n\ninterface VirtualScrollEventPayload {\n  currentX: number;\n  currentY: number;\n  offsetX: number;\n  offsetY: number;\n}\n\ninterface VirtualScrollConfig {\n  horizontal: boolean;\n  vertical: boolean;\n  keyBoardOffset: number;\n  boundaries?: VirtualScrollBoundaries;\n}\n\nclass VirtualScroll {\n  static Events = {\n    scroll: \"virtual-scroll-event-scroll\",\n  };\n  element: Window | HTMLElement = window;\n  config: VirtualScrollConfig;\n  pageX: number = 0;\n  pageY: number = 0;\n\n  keyBindings: { [key: string]: [number, number] } = {\n    down: [1, 0],\n    up: [-1, 0],\n    right: [0, 1],\n    left: [0, -1],\n  };\n  get boundaries(): VirtualScrollBoundaries {\n    return this.config.boundaries || {};\n  }\n  private mobileConfig: any = {\n    pressed: false,\n    timeConstant: 325,\n\n    reference: {\n      x: 0,\n      y: 0,\n    },\n    velocity: {\n      x: 0,\n      y: 0,\n    },\n    frame: {\n      x: 0,\n      y: 0,\n    },\n    target: {\n      x: 0,\n      y: 0,\n    },\n    timestamp: 0,\n    ticker: undefined,\n    amplitude: { x: 0, y: 0 },\n  };\n\n  constructor(\n    config: VirtualScrollConfig = {\n      vertical: true,\n      horizontal: false,\n      keyBoardOffset: 50,\n      boundaries: {},\n    }\n  ) {\n    this.config = config;\n\n    this.setEventListeners();\n  }\n\n  private scroll(offsetX: number, offsetY: number) {\n    if (this.config.vertical) {\n      this.pageY = this.pageY + offsetY;\n    }\n    if (this.config.horizontal) {\n      this.pageX = this.pageX + offsetX;\n    }\n    if (\n      this.boundaries.minX !== undefined &&\n      this.pageX < this.boundaries.minX\n    ) {\n      this.pageX = this.boundaries.minX;\n    }\n    if (\n      this.boundaries.maxX !== undefined &&\n      this.pageX > this.boundaries.maxX\n    ) {\n      this.pageX = this.boundaries.maxX;\n    }\n\n    if (\n      this.boundaries.minY !== undefined &&\n      this.pageY < this.boundaries.minY\n    ) {\n      this.pageY = this.boundaries.minY;\n    }\n\n    if (\n      this.boundaries.maxY !== undefined &&\n      this.pageY > this.boundaries.maxY\n    ) {\n      this.pageY = this.boundaries.maxY;\n    }\n\n    this.triggerEvent(VirtualScroll.Events.scroll, {\n      currentX: this.pageX,\n      currentY: this.pageY,\n      offsetX,\n      offsetY,\n    });\n  }\n\n  handleMouseScroll = (e: WheelEvent) => {\n    e.preventDefault();\n    this.scroll(e.deltaX, e.deltaY);\n  };\n\n  handleKeyDownMove = (e: KeyboardEvent) => {\n    console.log(e.key);\n    const keyBindChange = this.keyBindings[e.key];\n    if (keyBindChange) {\n      this.scroll(\n        keyBindChange[0] * this.config.keyBoardOffset,\n        keyBindChange[1] * this.config.keyBoardOffset\n      );\n    }\n  };\n\n  trackMobile() {\n    const now = Date.now();\n    const elapsed = now - this.mobileConfig.timestamp;\n    this.mobileConfig.timestamp = now;\n    const deltaX = this.pageX - this.mobileConfig.frame.x;\n    const deltaY = this.pageY - this.mobileConfig.frame.y;\n\n    this.mobileConfig.frame.x = this.pageX;\n    this.mobileConfig.frame.y = this.pageY;\n\n    const vX = (1000 * deltaX) / (1 + elapsed);\n    const vY = (1000 * deltaY) / (1 + elapsed);\n\n    this.mobileConfig.velocity.x =\n      0.8 * vX + 0.2 * this.mobileConfig.velocity.x;\n    this.mobileConfig.velocity.y =\n      0.8 * vY + 0.2 * this.mobileConfig.velocity.y;\n  }\n\n  mobileTouchStart(e: any) {\n    this.mobileConfig.pressed = true;\n    this.mobileConfig.reference = getCurrentMobilePositionFromEvent(e);\n\n    this.mobileConfig.velocity = this.mobileConfig.amplitude = { x: 0, y: 0 };\n    this.mobileConfig.frame.x = this.pageX;\n    this.mobileConfig.frame.y = this.pageY;\n    this.mobileConfig.timestamp = Date.now();\n    clearInterval(this.mobileConfig.ticker);\n    this.mobileConfig.ticker = setInterval(this.trackMobile, 100);\n    if (e.target.nodeName !== \"A\") {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n  }\n\n  mobileTouchMove(e: any) {\n    const { pressed, reference } = this.mobileConfig;\n    if (pressed) {\n      const { x, y } = getCurrentMobilePositionFromEvent(e);\n      let offsetY = reference.y - y;\n      let offsetX = reference.x - x;\n\n      if (offsetY > 2 || offsetY < -2) {\n        offsetY = 0;\n      }\n\n      if (offsetX > 2 || offsetX < -2) {\n        offsetX = 0;\n      }\n      reference.y = y;\n      this.scroll(offsetX, offsetY);\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  }\n  mobileAutoScroll = () => {\n    let deltaX = 0;\n    let deltaY = 0;\n\n    const { amplitude, timestamp, timeConstant, target } = this.mobileConfig;\n\n    if (amplitude.x) {\n      const elapsed = Date.now() - timestamp;\n      deltaX = -amplitude.x * Math.exp(-elapsed / timeConstant);\n    }\n    if (amplitude.y) {\n      const elapsed = Date.now() - timestamp;\n      deltaY = -amplitude.y * Math.exp(-elapsed / timeConstant);\n    }\n    if (deltaX > 0.5 || deltaX < -0.5 || deltaY > 0.5 || deltaY < -0.5) {\n      this.scroll(target.x + deltaX, target.y + deltaY);\n      requestAnimationFrame(this.mobileAutoScroll);\n    } else {\n      this.scroll(target.x, target.y);\n    }\n  };\n  mobileTouchEnd(e: any) {\n    const { ticker, amplitude, target, velocity } = this.mobileConfig;\n    this.mobileConfig.pressed = false;\n\n    clearInterval(ticker);\n    if (velocity.x > 10 || velocity.x < -10) {\n      amplitude.x = 0.8 * velocity.x;\n      target.x = Math.round(this.pageX + amplitude.x);\n    }\n    if (velocity.y > 10 || velocity.y < -10) {\n      amplitude.y = 0.8 * velocity.y;\n      target.y = Math.round(this.pageX + amplitude.y);\n    }\n    if (amplitude.x || amplitude.y) {\n      this.mobileConfig.timestamp = Date.now();\n      requestAnimationFrame(this.mobileAutoScroll);\n    }\n    if (e.target && e.target.nodeName !== \"A\") {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n  }\n\n  scrollEventKey =\n    \"onwheel\" in document.createElement(\"div\") ? \"wheel\" : \"mousewheel\";\n  setEventListeners() {\n    // @ts-ignore-next-line\n    this.element.addEventListener(this.scrollEventKey, this.handleMouseScroll, {\n      passive: false,\n    });\n    window.document.addEventListener(\"keydown\", this.handleKeyDownMove);\n\n    this.element.addEventListener(\"touchstart\", this.mobileTouchStart, {\n      passive: false,\n    });\n    this.element.addEventListener(\"touchmove\", this.mobileTouchMove, {\n      passive: false,\n    });\n    this.element.addEventListener(\"touchend\", this.mobileTouchEnd, {\n      passive: false,\n    });\n  }\n\n  /**\n   * EVENTS\n   */\n  eventWrappers: any[] = [];\n  triggerEvent(eventName: string, object: VirtualScrollEventPayload) {\n    document.dispatchEvent(new CustomEvent(eventName, { detail: object }));\n  }\n  on(\n    key: keyof typeof VirtualScroll.Events,\n    cb: (payload: VirtualScrollEventPayload) => void\n  ) {\n    const wrapped: any = ({ detail }: { detail: VirtualScrollEventPayload }) =>\n      cb(detail);\n    // @ts-ignore\n    this.eventWrappers[cb] = wrapped;\n    document.addEventListener(VirtualScroll.Events[key], wrapped);\n  }\n}\nexport default VirtualScroll;\n"],"mappings":"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","names":[]}